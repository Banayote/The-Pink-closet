<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .chat-container { width: 90%; max-width: 400px; margin: auto; }
        .messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; }
        .input-container { display: flex; margin-top: 10px; }
        input { flex: 1; padding: 10px; }
        button { padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Messages</h2>
    <div class="chat-container">
        <div class="messages" id="messages"></div>
        <div class="input-container">
            <input type="text" id="messageInput" placeholder="Type a message...">
            <button id="sendButton">Send</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const supabase = supabase.createClient(
                "https://fjlqkjwnelkamealhtyr.supabase.co",
                "eyJhbGciOiJIUzI1NiIsInR..."
            );

            const urlParams = new URLSearchParams(window.location.search);
            const sellerId = urlParams.get("seller_id");

            async function loadMessages() {
                const { data, error } = await supabase
                    .from("messages")
                    .select("*")
                    .eq("seller_id", sellerId);

                if (error) console.error("Error loading messages:", error);
                else {
                    const messageContainer = document.getElementById("messages");
                    messageContainer.innerHTML = "";
                    data.forEach(msg => {
                        const msgElement = document.createElement("p");
                        msgElement.textContent = msg.message;
                        messageContainer.appendChild(msgElement);
                    });

                    // Mark messages as read
                    await supabase.from("messages")
                        .update({ read_status: true })
                        .eq("seller_id", sellerId);
                }
            }

            document.getElementById("sendButton").addEventListener("click", async () => {
                const messageInput = document.getElementById("messageInput");
                const newMessage = messageInput.value.trim();

                if (newMessage) {
                    await supabase.from("messages").insert([
                        {
                            seller_id: sellerId,
                            message: newMessage,
                            timestamp: new Date().toISOString(),
                            read_status: false
                        }
                    ]);
                    messageInput.value = "";
                    loadMessages();
                }
            });

            loadMessages();
        });
    </script>
</body>
</html>

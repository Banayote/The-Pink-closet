<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Store</title>
</head>
<body>
    <h1>Create Your Store</h1>
    <form id="storeForm">
        <label for="firstName">First Name:</label>
        <input type="text" id="firstName" name="firstName" required><br>

        <label for="lastName">Last Name:</label>
        <input type="text" id="lastName" name="lastName" required><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br>

        <button type="submit">Create Store</button>
    </form>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // Initialize Supabase client
        const supabaseUrl = 'https://eczpdpysryifkekieloc.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjenBkcHlzcnlpZmtla2llbG9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIwMjQ2NDUsImV4cCI6MjA0NzYwMDY0NX0.lxC6cqnwH9hMbGC4AsE5W6JRt34eyp4MxhNtAl0MdM4';
        const supabase = createClient(supabaseUrl, supabaseKey);

        document.getElementById('storeForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            // Gather form data
            const formData = new FormData(this);
            const email = formData.get('email');
            const password = formData.get('password');
            const firstName = formData.get('firstName');
            const lastName = formData.get('lastName');

            try {
                // Use Supabase Auth to create a new user
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                });

                if (error) {
                    console.error('Error signing up:', error.message);
                    alert('Failed to create user. Please check the console for details.');
                    return;
                }

                // Store additional profile data in a Supabase table
                const userId = data.user.id; // Get the user's ID
                const profileResponse = await supabase.from('profiles').insert([
                    {
                        id: userId,
                        first_name: firstName,
                        last_name: lastName,
                    },
                ]);

                if (profileResponse.error) {
                    console.error('Error creating profile:', profileResponse.error.message);
                    alert('Profile creation failed.');
                    return;
                }

                // Save user data locally and redirect
                localStorage.setItem('user', JSON.stringify(data.user));
                alert('User successfully created!');
                window.location.href = 'profile.html';
            } catch (err) {
                console.error('Unexpected error:', err);
                alert('An unexpected error occurred.');
            }
        });
    </script>
</body>
</html>

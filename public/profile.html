<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <div class="profile-container">
        <div class="exit-icon">
            <a href="#" id="exitIcon"><span>&larr;</span> Back</a>
        </div>
        <div class="profile-info">
            <h1 id="username">Loading...</h1>
            <p id="user-role">Role: Seller</p>
            <div class="profile-actions">
                <button id="message">Message</button>
                <button id="add-product">Add Product</button>
                <button id="edit">Edit</button>
                <button id="copy-link">Link</button>
            </div>
        </div>
        <div class="profile-dashboard">
            <div class="stats">
                <h2>Sales</h2>
                <p id="sales-count">0</p>
                <h2>Visitors</h2>
                <p id="visitors-count">0</p>
            </div>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://eczpdpysryifkekieloc.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjenBkcHlzcnlpZmtla2llbG9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIwMjQ2NDUsImV4cCI6MjA0NzYwMDY0NX0.lxC6cqnwH9hMbGC4AsE5W6JRt34eyp4MxhNtAl0MdM4'; // Your Supabase API Key
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        document.addEventListener('DOMContentLoaded', async () => {
            const exitIcon = document.getElementById('exitIcon');
            const usernameElem = document.getElementById('username');
            const salesCountElem = document.getElementById('sales-count');
            const visitorsCountElem = document.getElementById('visitors-count');
            const userRoleElem = document.getElementById('user-role');

            const urlParams = new URLSearchParams(window.location.search);
            const uid = urlParams.get('uid');

            if (!uid) {
                alert('User ID not found in the URL.');
                window.location.href = 'index.html'; // Redirect to homepage
                return;
            }

            // Fetch user profile from Supabase based on user ID
            const { data, error } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', uid)
                .single();

            if (error || !data) {
                alert('Error fetching profile data.');
                window.location.href = 'index.html'; // Redirect to homepage if error
                return;
            }

            // Display user profile
            usernameElem.textContent = `${data.first_name} ${data.last_name}`;
            userRoleElem.textContent = `Role: ${data.role || 'Seller'}`;
            salesCountElem.textContent = data.sales || 0;
            visitorsCountElem.textContent = data.visitors || 0;

            // Handle exit (go back to homepage)
            exitIcon.addEventListener('click', () => {
                window.location.href = 'index.html'; // Redirect to homepage
            });
        });
    </script>
</body>
</html>

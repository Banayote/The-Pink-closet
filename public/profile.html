<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="profile.css">
</head>
<body>
    <div class="profile-container">
        <!-- Exit Icon with redirection to index.html -->
        <div class="exit-icon">
            <a href="#" id="exitIcon"><span>&larr;</span> Back</a>
        </div>
        <div class="banner">
            <div id="banner-images" class="banner-images">
                <img id="banner-img-1" src="image1.jpg" alt="Banner Image 1" class="banner-img">
                <img id="banner-img-2" src="image2.jpg" alt="Banner Image 2" class="banner-img">
                <img id="banner-img-3" src="image3.jpg" alt="Banner Image 3" class="banner-img">
            </div>
        </div>
        <div class="profile-picture">
            <img id="profile-img" src="profile-picture.jpg" alt="Profile Picture" onerror="this.src='default-profile.jpg';">
        </div>
        <div class="profile-info">
            <h1 id="username">Loading...</h1>
            <p id="user-role">Role: Seller</p>
            <div class="profile-actions">
                <button id="message"><span class="icon">‚úâÔ∏è</span> Message</button>
                <button id="add-product"><span class="icon">‚ûï</span> Add Product</button>
                <button id="edit"><span class="icon">üîß</span> Edit</button>
                <button id="copy-link"><span class="icon">üîó</span> Link</button>
            </div>
        </div>
        <div class="profile-dashboard">
            <div class="stats">
                <div class="stat">
                    <h2>Sales</h2>
                    <p id="sales-count">0</p>
                </div>
                <div class="stat">
                    <h2>Visitors</h2>
                    <p id="visitors-count">0</p>
                </div>
            </div>
        </div>
        <div class="product-list-button">
            <button id="view-products">View Product List</button>
        </div>
        <div class="user-products">
            <!-- User's posted products will be dynamically displayed here -->
        </div>
    </div>
    <!-- Modal for displaying images -->
    <div id="image-modal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="modal-img">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const exitIcon = document.getElementById('exitIcon');
            const usernameElem = document.getElementById('username');
            const profileImg = document.getElementById('profile-img');
            const salesCountElem = document.getElementById('sales-count');
            const visitorsCountElem = document.getElementById('visitors-count');
            const userRoleElem = document.getElementById('user-role');

            // Extract seller_id from the query string
            const urlParams = new URLSearchParams(window.location.search);
            const sellerId = urlParams.get('seller_id');

            if (!sellerId) {
                alert('No seller ID found. Redirecting to home page.');
                window.location.href = 'index.html';
                return;
            }

            try {
                // Fetch user data from Supabase
                const response = await fetch(`https://eczpdpysryifkekieloc.supabase.co/rest/v1/users?id=eq.${sellerId}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjenBkcHlzcnlpZmtla2llbG9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIwMjQ2NDUsImV4cCI6MjA0NzYwMDY0NX0.lxC6cqnwH9hMbGC4AsE5W6JRt34eyp4MxhNtAl0MdM4',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjenBkcHlzcnlpZmtla2llbG9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIwMjQ2NDUsImV4cCI6MjA0NzYwMDY0NX0.lxC6cqnwH9hMbGC4AsE5W6JRt34eyp4MxhNtAl0MdM4'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Failed to fetch user data. Status: ${response.status}`);
                }

                const userData = await response.json();

                if (userData.length > 0) {
                    const user = userData[0];
                    usernameElem.textContent = `${user.first_name} ${user.last_name}`;
                    profileImg.src = user.profile_img || 'profile-picture.jpg'; // Use default image if not provided
                    salesCountElem.textContent = user.sales || 0;
                    visitorsCountElem.textContent = user.visitors || 0;
                    userRoleElem.textContent = `Role: ${user.role || 'Seller'}`;
                } else {
                    alert('User not found. Redirecting to home page.');
                    window.location.href = 'index.html';
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
                alert('An unexpected error occurred while loading the profile.');
                window.location.href = 'index.html'; // Redirect to home page on error
            }

            // Exit profile
            exitIcon.addEventListener('click', (event) => {
                event.preventDefault();
                window.location.href = 'index.html';
            });
        });
    </script>
</body>
</html>


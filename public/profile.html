<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
</head>
<body>
    <h1 id="username">Loading profile...</h1>
    <button id="add-product">Add Product</button>
    <button id="message">Message</button>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        const SUPABASE_URL = 'https://fjlqkjwnelkamealhtyr.supabase.co';  
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqbHFranduZWxrYW1lYWxodHlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcyMDUyMDYsImV4cCI6MjA1Mjc4MTIwNn0.WOvuaxbIyDPyAp8mk7-ebhB6QdNI8EXbycA9XEg-US4';  
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        document.addEventListener('DOMContentLoaded', async () => {
            const userEmail = localStorage.getItem('email');

            if (!userEmail) {
                alert('No email found. Redirecting...');
                window.location.href = 'store.html';  
                return;
            }

            document.getElementById('username').textContent = `Welcome, ${userEmail}`;

            // Check if user exists in the database
            let { data: user, error } = await supabase
                .from('users')
                .select('*')
                .eq('email', userEmail)
                .single();

            if (error && error.code !== 'PGRST116') { // Ignore "not found" error
                console.error('Error fetching user:', error);
                alert('Could not load profile.');
                return;
            }

            if (!user) {
                // If user doesn't exist, create a new profile
                let { error: insertError } = await supabase.from('users').insert([{ email: userEmail }]);

                if (insertError) {
                    console.error('Error creating profile:', insertError);
                    return;
                }
                console.log('New user profile created');
            }

            // Add Product button
            document.getElementById('add-product').addEventListener('click', () => {
                window.location.href = 'add-product.html';
            });

            // Message button (we will connect this later)
            document.getElementById('message').addEventListener('click', () => {
                alert('Messaging system will be added next!');
            });
        });
    </script>
</body>
</html>


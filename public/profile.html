<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="profile.css">
</head>
<body>
    <div class="profile-container">
        <div class="exit-icon">
            <a href="#" id="exitIcon"><span>&larr;</span></a>
        </div>
        <div class="profile-picture">
            <img id="profile-img" src="default-profile.jpg" alt="Profile Picture">
        </div>
        <div class="profile-info">
            <h1 id="username">Loading...</h1>
            <p>Banayote</p>
        </div>
        <div class="profile-dashboard">
            <div class="stats">
                <div class="stat">
                    <h2>Sales</h2>
                    <p id="sales-count">0</p>
                </div>
                <div class="stat">
                    <h2>Visitors</h2>
                    <p id="visitors-count">0</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://eczpdpysryifkekieloc.supabase.co';
        const SUPABASE_API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjenBkcHlzcnlpZmtla2llbG9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIwMjQ2NDUsImV4cCI6MjA0NzYwMDY0NX0.lxC6cqnwH9hMbGC4AsE5W6JRt34eyp4MxhNtAl0MdM4';

        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const userEmail = params.get('email');

            if (!userEmail) {
                alert('No user email found in the query parameters!');
                window.location.href = 'index.html'; // Redirect to homepage
                return;
            }

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/users?email=eq.${userEmail}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_API_KEY,
                        'Authorization': `Bearer ${SUPABASE_API_KEY}`
                    }
                });

                const result = await response.json();

                if (result.length === 0) {
                    alert('User not found!');
                    window.location.href = 'index.html';
                    return;
                }

                const user = result[0];

                // Populate the profile with user data
                document.getElementById('username').textContent = `${user.first_name} ${user.last_name}`;
                document.getElementById('profile-img').src = user.profile_img || 'default-profile.jpg';
                document.getElementById('sales-count').textContent = user.sales || 0;
                document.getElementById('visitors-count').textContent = user.visitors || 0;
            } catch (error) {
                console.error('Error fetching user data:', error);
                alert('An error occurred while loading the profile.');
            }
        });
    </script>
</body>
</html>
